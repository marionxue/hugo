<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Kubernetes 使用集群联邦实现多集群管理 - yangcs.net|杨传胜的博客|Kubernetes|Big Data</title>
  <meta name="description" content="yangcs.net|杨传胜的博客|Kubernetes|Big Data" />
  <meta property="og:title" content="Kubernetes 使用集群联邦实现多集群管理" />
  <meta name="twitter:title" content="Kubernetes 使用集群联邦实现多集群管理" />
  <meta name="description" content="使用联邦服务进行跨集群服务发现">
  <meta property="og:description" content="使用联邦服务进行跨集群服务发现">
  <meta name="twitter:description" content="使用联邦服务进行跨集群服务发现">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='http://o7z41ciog.bkt.clouddn.com/favicon.png' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="http://o7z41ciog.bkt.clouddn.com/05ba932c.jpg" />
  <meta name="twitter:image" content="http://o7z41ciog.bkt.clouddn.com/05ba932c.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@Paranoid_yang" />
  <meta name="twitter:creator" content="@Paranoid_yang" />
  <meta property="og:url" content="https://www.yangcs.net/posts/federation/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Ryan Yang" />

  <meta name="generator" content="Hugo 0.37" />
  <link rel="canonical" href="https://www.yangcs.net/posts/federation/" />
  <link rel="alternate" href="https://www.yangcs.net/index.xml" type="application/rss+xml" title="Ryan Yang">
  <script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://www.yangcs.net/css/main.css" />
  <link rel="stylesheet" href="https://www.yangcs.net/css/search.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  

<meta name="baidu-site-verification" content="g8IYR9SNLF" />
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

<link rel="stylesheet" href="https://www.yangcs.net/css/prism.css" />







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.yangcs.net">Ryan Yang</a>
    </div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">文章分类</a>
              <div class="navlinks-children">
                
                
                  <a href="https://www.yangcs.net/categories/kubernetes">kubernetes</a>
                
                
                  <a href="https://www.yangcs.net/categories/docker">Docker</a>
                
                
                  <a href="https://www.yangcs.net/categories/python">Python</a>
                
                
                  <a href="https://www.yangcs.net/categories/gfw">科学上网</a>
                
                
                  <a href="https://www.yangcs.net/categories/math">数学</a>
                
                
                  <a href="https://www.yangcs.net/tags">Tags</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">书籍推荐</a>
              <div class="navlinks-children">
                
                
                  <a href="https://www.yangcs.net/talent-is-overrated">天才源自刻意练习</a>
                
                
                  <a href="https://www.gitbook.com/book/yeasy/docker_practice">Docker handbook</a>
                
                
                  <a href="http://istio.doczh.cn">Istio service mesh</a>
                
                
                  <a href="https://github.com/ruanyf/reading-list">阮一峰书单</a>
                
                
                  <a href="https://github.com/fengdu78/Coursera-ML-AndrewNg-Notes">机器学习笔记</a>
                
                
                  <a href="https://www.yangcs.net/the-way-to-go">Go 入门指南</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="脚本推荐" href="/">脚本推荐</a>
              
              
            </li>
          
        
          
            <li>
              <a title="关于我" href="/resume/">关于我</a>
              
              
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Ryan Yang" href="https://www.yangcs.net">
            <img class="avatar-img" src="http://o7z41ciog.bkt.clouddn.com/05ba932c.jpg" alt="Ryan Yang" />
          </a>
        
      </div>
    </div>

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search jimmysong.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>



<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/algoliasearch.min.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/autocomplete.min.js"></script>

<script>
var client = algoliasearch("MQX1EH3YCM", "0ba826b1f47a96e128409a6706d41e86");
var index = client.initIndex('hugo');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion.uri+ '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>


    
  
  
  




  
    <div id="header-big-imgs" data-num-img=1 data-img-src-1="http://o7z41ciog.bkt.clouddn.com/picHD_12.png" ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        
        <div class="container">
          <div class="row">
              <div class="col-lg-12 col-md-12 col-md-offset-0">
                
                <div class="post-heading">
                
                  
                     <h1>Kubernetes 使用集群联邦实现多集群管理</h1>
                     
                     
                  
                  
                  
                    
                      <hr class="small">
                      <span class="post-subheading">使用联邦服务进行跨集群服务发现</span>
                    
                  
                  
                    <span class="post-meta">
  
  Posted on March 22, 2018
  
  
</span>


                  
                
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Kubernetes 使用集群联邦实现多集群管理</h1>
                
                  
                    <h2 align="center" class="posts-subheading">使用联邦服务进行跨集群服务发现</h2>
                  
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            
            
            
<div>
    <section id="datecount">
        <h4 id="date"> Thu Mar 22, 2018</h4>
    </section>
    <h5 id="wc">4400 Words|Read in about 9 Min</h5>
    <h5 id="tags">Tags: 
        
        <a href="https://www.yangcs.nettags/kubernetes/">kubernetes</a> &nbsp;
    </h5>
</div>

            
            <article role="main" class="blog-post" itemprop="articleBody" id="content">
                <p>
在云计算环境中，服务的作用距离范围从近到远一般可以有：</p>

<ul>
<li>同主机（Host，Node）</li>
<li>跨主机同可用区（Available Zone）</li>
<li>跨可用区同地区（Region）</li>
<li>跨地区同服务商（Cloud Service Provider）</li>
<li>跨云平台</li>
</ul>

<p>K8s 的设计定位是单一集群在同一个地域内，因为同一个地区的网络性能才能满足 K8s 的调度和计算存储连接要求。</p>

<p>但是实际情况中经常遇到的一些问题，就是单个集群通常无法跨单个云厂商的多个 Region，更不用说支持跨跨域不同的云厂商。这样会给企业带来一些担忧，如何应对可用区级别的 Fail，以及容灾备份？是否会造成厂商锁定，增加迁移成本？如何应对线上线下突发流量？如何统一管理调度容器资源？单个集群规模的上限等等。</p>

<p>集群联邦（Federation）可以一定程度上解决这些问题。<code>Federation</code> 是可以将分布在多个 Region 或者多个云厂商的 Kubernetes 集群整合成一个大的集群，统一管理与调度。</p>

<h2 id="p-id-h2-1-kubernetes集群联邦介绍-p"><p id="h2">1. Kubernetes集群联邦介绍</p></h2>

<hr />

<h3 id="管理多个-kuberntes-集群">管理多个 kuberntes 集群</h3>

<p><strong>集群联邦</strong>在架构上同 kubernetes 集群很相似。有一个<strong>集群联邦</strong>的 API server 提供一个标准的 Kubernetes API，并且通过 etcd 来存储状态。不同的是，一个通常的Kubernetes 只是管理节点计算，而<strong>集群联邦</strong>管理所有的 kubernetes 集群。</p>

<p><center><img src="http://o7z41ciog.bkt.clouddn.com/federation-api-4x.png" alt="" /></center></p>

<p>Federation主要包括三个组件：</p>

<ul>
<li><strong>federation-apiserver：</strong>类似 <code>kube-apiserver</code>，但提供的是跨集群的 REST API</li>
<li><strong>federation-controller-manager：</strong>类似 <code>kube-controller-manager</code>，但提供多集群状态的同步机制</li>
<li><strong>kubefed：</strong>Federation 管理命令行工具</li>
</ul>

<p>用户可以通过 Federation 的 API Server 注册该 Federation 的成员 <code>K8s Cluster</code>。当用户通过 Federation 的 API Server 创建、更改 API 对象时，<code>Federation API Server</code> 会在自己所有注册的子 K8s Cluster 都创建一份对应的 API 对象。</p>

<p>在提供业务请求服务时，<code>K8s Federation</code> 会先在自己的各个子 Cluster 之间做负载均衡，而对于发送到某个具体 <code>K8s Cluster</code> 的业务请求，会依照这个 K8s Cluster 独立提供服务时一样的调度模式去做 K8s Cluster 内部的负载均衡。而Cluster 之间的负载均衡是通过域名服务的负载均衡来实现的。</p>

<p>所有的设计都尽量不影响 K8s Cluster 现有的工作机制，这样对于每个子 K8s 集群来说，并不需要更外层的有一个 K8s Federation，也就是意味着所有现有的 K8s 代码和机制不需要因为 <code>Federation</code> 功能有任何变化。</p>

<h3 id="跨集群服务发现">跨集群服务发现</h3>

<p>Kubernetes 有一个标准的插件：<code>kube-dns</code>，这个插件可以在集群内部提供 DNS 服务，通过 DNS 解析 service 名字来访问 kubernetes 服务。<br /></p>

<p>Kubernetes 服务是由一组 kubernetes POD 组成的，这些 POD 是一些已经容器化了的应用，这些 POD 前面使用到了负载均衡器。<br /></p>

<p>假如我们有一个 kubernetes 集群，这个集群里面有一个服务叫做 mysql，这个服务是由一组 mysql POD 组成的。在这个 kubernetes 集群中，其他应用可以通过 DNS 来访问这个 mysql 服务。</p>

<p><img src="http://o7z41ciog.bkt.clouddn.com/federation-dns.jpg" alt="" /></p>

<h3 id="跨集群调度">跨集群调度</h3>

<p id="div-border-top-red">为了追求高可用性和更高的性能，集群联邦能够把不同 POD 指定给不同的 Kubernetes 集群中。集群联邦调度器将决定如何在不同 kubernetes 集群中分配工作负载。</p>

<p>通过跨集群调度，我们可以：</p>

<ul>
<li>跨 kubernetes 集群均匀的调度任务负载</li>
<li>将各个 kubernetes 集群的工作负载进行最大化，如果当前 kubernetes 集群超出了承受能力，那么将额外的工作负载路由到另一个比较空闲的 kubernetes 集群中</li>
<li>根据应用地理区域需求，调度工作负载到不同的 kubernetes 集群中，对于不同的终端用户，提供更高的带宽和更低的延迟。</li>
</ul>

<h3 id="集群高可用-故障自动迁移">集群高可用，故障自动迁移</h3>

<p>集群联邦可以跨集群冗馀部署，当某个集群所在区域出现故障时，并不影响整个服务。集群联邦还可以检测集群是否为不可用状态，如果发现某个集群为不可用状态时，可以将失败的任务重新分配给集群联邦中其他可用状态的集群上。</p>

<h2 id="p-id-h2-2-使用集群联邦实现多集群管理-p"><p id="h2">2. 使用集群联邦实现多集群管理</p></h2>

<hr />

<h3 id="系统环境">系统环境</h3>

<table>
<thead>
<tr>
<th align="left">功能组件</th>
<th align="center">系统组件</th>
<th align="left">系统版本</th>
<th align="left">设备数量</th>
<th align="left">备注</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">联邦集群控制平面</td>
<td align="center">k8s 1.9+Federation</td>
<td align="left">CentOS 7.3</td>
<td align="left">3台</td>
<td align="left">联邦集群控制平面</td>
</tr>

<tr>
<td align="left">K8s集群01</td>
<td align="center">k8s 1.9 master+node</td>
<td align="left">CentOS 7.3</td>
<td align="left">3台</td>
<td align="left">联邦集群节点</td>
</tr>
</tbody>
</table>

<h3 id="安装-kubefed">安装 kubefed</h3>

<p>选择其中的一个集群作为主集群，这个主集群将运行组成联邦控制面板的所有组件。</p>

<p>使用下列命令下载对应最新发行的 <code>kubefed</code> 安装包并将安装包里的二进制文件解压出来：</p>

<pre><code class="language-bash">$ curl -LO https://storage.cloud.google.com/kubernetes-federation-release/release/${RELEASE-VERSION}/federation-client-linux-amd64.tar.gz
$ tar -xzvf federation-client-linux-amd64.tar.gz
</code></pre>

<p>请用<a href="https://github.com/kubernetes/federation/releases" target="_blank">federation release page</a>页面实际的版本号替换变量 <code>RELEASE-VERSION</code>。</p>

<p>将解压出来的内容复制到你的环境变量 <code>$PATH</code> 里的随便一个路径， 并设置可执行权限。</p>

<pre><code class="language-bash">$ cp federation/client/bin/kubefed /usr/local/bin
$ chmod +x /usr/local/bin/kubefed
</code></pre>

<h3 id="配置-context">配置 context</h3>

<p>在准备配置联邦集群的 DCE 集群中配置两个 DCE 集群的 <code>context</code>。让改节点能通过切换 <code>context</code> 连接不同的子集群。</p>

<p>先创建本地集群的 <code>kubeconfig</code> 文件</p>

<pre><code class="language-bash">$ export KUBE_APISERVER=&quot;https://192.168.123.250:6443&quot;
# 设置集群参数
$ kubectl config set-cluster kubernetes \
  --certificate-authority=/etc/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER}
# 设置客户端认证参数
$ kubectl config set-credentials admin \
  --client-certificate=/etc/kubernetes/ssl/admin.pem \
  --embed-certs=true \
  --client-key=/etc/kubernetes/ssl/admin-key.pem
# 设置上下文参数
$ kubectl config set-context kubernetes \
  --cluster=kubernetes \
  --user=admin
# 设置默认上下文
$ kubectl config use-context kubernetes
</code></pre>

<p>生成的 kubeconfig 被保存到 <code>~/.kube/config</code> 文件。</p>

<p id="div-border-top-purple">注意：~/.kube/config 文件拥有对该集群的最高权限，请妥善保管。</p>

<p>配置结果如下：</p>

<pre><code class="language-bash">$ kubectl config get-contexts

CURRENT   NAME          CLUSTER       AUTHINFO      NAMESPACE    
*         kubernetes    kubernetes    admin
</code></pre>

<h3 id="设置-coredns-作为集群联邦的-dns-提供商">设置 CoreDNS 作为集群联邦的 DNS 提供商</h3>

<h4 id="1-前提">1. 前提</h4>

<ul>
<li>为启用 <code>CoreDNS</code> 来实现跨联邦集群的服务发现，联邦的成员集群中必须支持 <code>LoadBalancer</code> 服务。（<font color="red">本地集群暂不支持 <code>LoadBalancer</code> 服务，所以不能使用 <code>coredns</code> 来实现 federation 的服务发现功能！！！</font>）</li>
<li>我们可以利用 <code>helm charts</code> 来部署 CoreDNS。 CoreDNS 部署时会以 etcd 作为后端，并且 etcd 应预先安装。 etcd 也可以利用 helm charts 进行部署。</li>
</ul>

<h4 id="2-安装-helm">2. 安装 helm</h4>

<p>首先需要安装 <code>helm</code> 客户端</p>

<pre><code class="language-bash">$ curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get &gt; get_helm.sh
$ chmod 700 get_helm.sh
$ ./get_helm.sh
</code></pre>

<p>创建 tiller 的 <code>serviceaccount</code> 和 <code>clusterrolebinding</code></p>

<pre><code class="language-bash">$ kubectl create serviceaccount --namespace kube-system tiller
$ kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller
</code></pre>

<p>然后安装 helm 服务端 <code>tiller</code></p>

<pre><code class="language-bash">$ helm init
</code></pre>

<p>为应用程序设置 <code>serviceAccount</code>：</p>

<pre><code class="language-bash">$ kubectl patch deploy --namespace kube-system tiller-deploy -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'
</code></pre>

<p>检查是否安装成功：</p>

<pre><code class="language-bash">$ kubectl -n kube-system get pods|grep tiller

tiller-deploy-7bf964fff8-sklts                1/1       Running   0          7h

$ helm version

Client: &amp;version.Version{SemVer:&quot;v2.8.2&quot;, GitCommit:&quot;a80231648a1473929271764b920a8e346f6de844&quot;, GitTreeState:&quot;clean&quot;}
Server: &amp;version.Version{SemVer:&quot;v2.8.2&quot;, GitCommit:&quot;a80231648a1473929271764b920a8e346f6de844&quot;, GitTreeState:&quot;clean&quot;}
</code></pre>

<h4 id="3-部署-etcd">3. 部署 etcd</h4>

<p>下载 <code>helm charts</code> 仓库</p>

<pre><code class="language-bash">$ git clone https://github.com/kubernetes/charts.git
</code></pre>

<p>部署 <code>etcd-operator</code>（etcd-operator 会通过 kubernetes 的 <code>CustomResourceDefinition</code> 自动创建 <code>etcd cluster</code>）</p>

<pre><code class="language-bash">$ cd charts

$ helm install --name etcd-operator stable/etcd-operator --set rbac.install=true,rbac.apiVersion=v1,customResources.createEtcdClusterCRD=true
</code></pre>

<p>检查是否部署成功</p>

<pre><code class="language-bash">$ kubectl get pods

NAME                                                              READY     STATUS    RESTARTS   AGE
etcd-cluster-6skfqj9mwp                                           1/1       Running   0          7m
etcd-cluster-6w8ntzvkwm                                           1/1       Running   0          8m
etcd-cluster-mclzhqrldf                                           1/1       Running   0          7m
etcd-operator-etcd-operator-etcd-backup-operator-5df985959bvvkw   1/1       Running   0          9m
etcd-operator-etcd-operator-etcd-operator-58d98b95c-x44bz         1/1       Running   0          9m
etcd-operator-etcd-operator-etcd-restore-operator-8688c7684nmdh   1/1       Running   0          9m

$ kubectl get crd

NAME                                    AGE
etcdbackups.etcd.database.coreos.com    1d
etcdclusters.etcd.database.coreos.com   1d
etcdrestores.etcd.database.coreos.com   1d

$ kubectl get crd etcdclusters.etcd.database.coreos.com -o yaml

apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
...
...
spec:
  group: etcd.database.coreos.com
  names:
    kind: EtcdCluster
    listKind: EtcdClusterList
    plural: etcdclusters
    shortNames:
    - etcd
    singular: etcdcluster
  scope: Namespaced
  version: v1beta2
...
...

$ kubectl get EtcdCluster

NAME           AGE
etcd-cluster   11m

$ kubectl get svc

NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
etcd-cluster            ClusterIP   None             &lt;none&gt;        2379/TCP,2380/TCP   17m
etcd-cluster-client     ClusterIP   10.254.140.7     &lt;none&gt;        2379/TCP            17m
etcd-restore-operator   ClusterIP   10.254.177.113   &lt;none&gt;        19999/TCP           18m
kubernetes              ClusterIP   10.254.0.1       &lt;none&gt;        443/TCP             16d
</code></pre>

<p>部署成功后，可以在 host 集群内通过 <a href="http://etcd-cluster-client.default:2379" target="_blank">http://etcd-cluster-client.default:2379</a> 端点访问 etcd。</p>

<h4 id="4-部署-coredns">4. 部署 CoreDNS</h4>

<p>首先需要定制 <code>CoreDNS chart</code> 模板的默认配置，它会覆盖 <code>CoreDNS chart</code> 的默认配置参数。</p>

<pre><code class="language-bash">$ cat Value.yaml

isClusterService: false
serviceType: &quot;NodePort&quot;
plugins:
  kubernetes:
    enabled: false
  etcd:
    enabled: true
    zones:
    - &quot;example.com.&quot;
    endpoint: &quot;http://etcd-cluster-client.default:2379&quot;
</code></pre>

<p>参数说明：</p>

<ul>
<li><code>isClusterService</code>: 指定 CoreDNS 是否以集群服务的形式部署（默认为是）。 需要将其设置为 “false”，以使 CoreDNS 以 Kubernetes 应用服务的形式部署，否则会与集群的 dns 服务 kubedns 冲突。</li>
<li><code>serviceType</code>: 指定为 CoreDNS 创建的 Kubernetes 服务类型。 选择 “NodePort”，以使得 CoreDNS 服务能够从 Kubernetes 集群外部访问。</li>
<li><code>plugins.kubernetes</code>: 默认是启用的，通过将 <code>plugins.kubernetes.enabled</code> 设置为 “false” 来禁用 plugins.kubernetes。</li>
<li>通过将 plugins.etcd.enabled 设置为 “true” 来启用 plugins.etcd。</li>
<li>通过设置 <code>plugins.etcd.zones</code> 来配置 CoreDNS 被授权的 DNS 区域（联邦区域）。</li>
<li>通过设置 <code>plugins.etcd.endpoint</code> 来设置先前部署的 etcd 的端点。</li>
</ul>

<p>现在运行以下命令来部署 CoreDNS：</p>

<pre><code class="language-bash">$ helm install --name coredns -f Values.yaml stable/coredns
</code></pre>

<p>验证部署：</p>

<pre><code class="language-bash">$ kubectl get pods -l app=coredns-coredns

NAME                               READY     STATUS    RESTARTS   AGE
coredns-coredns-57b54ddb97-xffnc   1/1       Running   0          1d

$ kubectl get svc -l app=coredns-coredns

NAME              TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                                    AGE
coredns-coredns   NodePort   10.254.198.211   &lt;none&gt;        53:27165/UDP,53:27165/TCP,9153:26492/TCP   1d
</code></pre>

<h4 id="5-使用-coredns-作为-dns-提供商来部署-federation">5. 使用 CoreDNS 作为 DNS 提供商来部署 Federation</h4>

<p>可以使用 <code>kubefed init</code> 来部署联邦控制平面。 可以通过指定两个附加参数来选择 CoreDNS 作为 DNS 提供商。</p>

<pre><code class="language-bash">--dns-provider=coredns
--dns-provider-config=coredns-provider.conf
</code></pre>

<p>coredns-provider.conf 内容如下：</p>

<pre><code class="language-bash">[Global]
etcd-endpoints = http://etcd-cluster-client.default:2379
zones = example.com.
coredns-endpoints = &lt;coredns-server-ip&gt;:&lt;port&gt;
</code></pre>

<ul>
<li><code>etcd-endpoints</code> 是访问 etcd 的端点。</li>
<li><code>zones</code> 是 CoreDNS 被授权的联邦区域，其值与 <code>kubefed init</code> 的 –-dns-zone-name 参数相同。</li>
<li><code>coredns-endpoints</code> 是访问 CoreDNS 服务器的端点。 这是一个 1.7 版本开始引入的可选参数。</li>
</ul>

<p id="div-border-top-purple">注意：CoreDNS 配置中的 <code>plugins.etcd.zones</code> 与 kubefed init 的 –-dns-zone-name 参数应匹配。</p>

<p>通过本条命令初始化 federation 控制平面，参数如下：</p>

<pre><code class="language-bash">$ kubefed init federation \ # 联邦的名字
  --host-cluster-context=kubernetes \ # 主集群的context名字
  --dns-provider=coredns \ # DNS服务提供商
  --dns-zone-name=&quot;example.com.&quot; \ # 前面注册好的域名，必须以.结束
  --dns-provider-config=&quot;coredns-provider.conf&quot; \ # coredns 配置文件
  --api-server-service-type=&quot;NodePort&quot; \
  --api-server-advertise-address=&quot;192.168.123.250&quot;

  Creating a namespace federation-system for federation system components... done
  Creating federation control plane service..... done
  Creating federation control plane objects (credentials, persistent volume claim)... done
  Creating federation component deployments... done
  Updating kubeconfig... done
  Waiting for federation control plane to come up..................................................................................................................................................... done
  Federation API server is running at: 10.110.151.216
</code></pre>

<p>观察以上输出信息，该命令做了以下几件事情：</p>

<ol>
<li><p>创建一个 namespace <code>federation-system</code></p>

<pre><code class="language-bash">$ kubectl get ns

NAME                STATUS    AGE
default             Active    8d
federation-system   Active    8s
kube-public         Active    8d
kube-system         Active    8d
my-namespace        Active    7d
</code></pre></li>

<li><p>创建两个服务 <code>federation-apiserver</code> 和 <code>federation-controller-manager</code></p>

<pre><code class="language-bash">$ kubectl -n federation-system get pods

NAME                                             READY     STATUS         RESTARTS   AGE
federation-apiserver-909415585-wktmw             1/1       Running   0          2s
federation-controller-manager-4247980660-c8ls5   1/1       Running   1          3s
</code></pre></li>

<li><p>创建一个 ServiceAccount <code>federation-controller-manager</code></p>

<pre><code class="language-bash">$ kubectl -n federation-system get sa

NAME                            SECRETS   AGE
default                         1         31m
federation-controller-manager   1         31m
</code></pre></li>

<li><p>创建一个 Role <code>federation-system:federation-controller-manager</code></p>

<pre><code class="language-bash">$ kubectl -n federation-system get role

NAME                                              AGE
federation-system:federation-controller-manager   38m
</code></pre></li>

<li><p>创建一个 RoleBinding <code>federation-system:federation-controller-manager</code></p>

<pre><code class="language-bash">$ kubectl -n federation-system get rolebinding

NAME                                              AGE
federation-system:federation-controller-manager   39m
</code></pre></li>

<li><p>创建一个 context <code>federation</code></p></li>
</ol>

<pre><code class="language-bash">    $ kubectl config get-contexts

    CURRENT   NAME         CLUSTER      AUTHINFO     NAMESPACE
              federation   federation   federation
    *         kubernetes   kubernetes   admin
</code></pre>

<p id="div-border-top-purple"><strong>注意：</strong>默认情况下，<code>kubefed init</code> 通过动态创建 PV 的方式为 etcd 创建持久化存储。如果 kubernetes 集群不支持动态创建 PV，则可以预先创建 PV，注意 PV 要匹配 `kubefed` 的 PVC。或者使用 <code>hostpath</code>，同时指定调度节点。</p>

<h4 id="6-添加集群至-federation">6. 添加集群至 federation</h4>

<p>目前为止您已经成功的初始化好了 <code>Federation</code> 的控制平面。接下来需要将各个子集群加入到 Federation 集群中。</p>

<p>添加集群 <code>kubernetes</code>：</p>

<pre><code class="language-bash">$ kubefed join kubernetes \ #加入联邦的集群命名名字
  --context=federation \ #联邦的context
  --cluster-context=kubernetes \ #要添加集群的context
  --host-cluster-context=kubernetes #主集群的context

$ kubectl --context=federation get cluster

NAME          STATUS    AGE
kubernetes    Ready     6d
</code></pre>

<p>通过我的观察，以上过程在 <code>加入 federation 的 kubernetes 集群中</code> 做了以下几件事情：</p>

<ol>
<li><p>在 namespace <code>federation-system</code> 中创建一个 ServiceAccount <code>kubernetes-kubernetes</code></p>

<pre><code class="language-bash">$ kubectl -n federation-system get sa

NAME                            SECRETS   AGE
default                         1         45m
federation-controller-manager   1         45m
kubernetes-kubernetes           1         8m
</code></pre></li>

<li><p>创建一个 ClusterRole <code>federation-controller-manager:federation-kubernetes-kubernetes</code></p>

<pre><code class="language-bash">$ kubectl get clusterrole|egrep &quot;NAME|federation&quot;

NAME                                                                   AGE
federation-controller-manager:federation-kubernetes-kubernetes         10m
</code></pre></li>

<li><p>创建一个 ClusterRoleBinding <code>federation-controller-manager:federation-kubernetes-kubernetes</code></p>

<pre><code class="language-bash">$ kubectl get clusterrolebinding|egrep &quot;NAME|federation&quot;

NAME                                                             AGE
federation-controller-manager:federation-kubernetes-kubernetes   11m
</code></pre></li>
</ol>

<p>整个过程是否还进行了其他操作，暂时没有发现，有待继续研究。</p>

<p><strong>介绍下集群查询，移除集群，删除联邦等命令：</strong></p>

<p>查询注册到 Federation 的 kubernetes 集群列表</p>

<pre><code class="language-bash">$ kubectl --context=federation get clusters

NAME          STATUS    AGE
kubernetes    Ready     8m
</code></pre>

<p>移除 <code>kubernetes</code> 集群</p>

<pre><code class="language-bash">$ kubefed unjoin kubernetes --host-cluster-context=kubernetes --context=federation

Successfully removed cluster &quot;kubernetes&quot; from federation

$ kubectl --context=federation get clusters

No resources found.
</code></pre>

<p>集群联邦控制平面的删除功能还在开发中，目前可以通过删除 namespace <code>federation-system</code> 的方法来清理（注意pv不会删除）。命令在 host-cluster-context 上执行。</p>

<pre><code class="language-bash">$ kubectl delete ns federation-system
</code></pre>

<h2 id="p-id-h2-3-federation-支持的服务-p"><p id="h2">3. Federation 支持的服务</p></h2>

<hr />

<p>集群联邦支持以下联邦资源，这些资源会自动在所有注册的 <code>kubernetes</code> 集群中创建。</p>

<ul>
<li>Federated ConfigMap</li>
<li>Federated Service</li>
<li>Federated DaemonSet</li>
<li>Federated Deployment</li>
<li>Federated Ingress</li>
<li>Federated Namespaces</li>
<li>Federated ReplicaSets</li>
<li>Federated Secrets</li>
<li>Federated Events（仅存在federation控制平面）</li>
<li>Federated Jobs（v1.8+）</li>
<li>Federated Horizontal Pod Autoscaling (HPA，v1.8+)</li>
</ul>

<p>示例：</p>

<p>创建 <code>deployment</code></p>

<pre><code class="language-bash">$ cat nginx-deployment.yaml

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80

$ kubectl --context=federation create -f nginx-deployment.yaml
</code></pre>

<p>可以通过 <code>kubectl scale deploy nginx --replicas=3 --context=federation</code> 来扩展 nginx 副本，然后观察 nginx 应用在各个子集群中的分布情况。</p>

<pre><code class="language-bash">$ kubectl --context=kubernetes get deploy
</code></pre>

<p><strong>目前由于在私有环境上无法实现跨集群服务发现的功能，所以无法使用 <code>Federated Service</code>。</strong></p>

<h2 id="p-id-h2-4-参考文档-p"><p id="h2">4. 参考文档</p></h2>

<hr />

<ul>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/federation/" target="_blank">Kubernetes federation</a></li>
<li><a href="https://kubernetes.io/docs/tasks/federation/set-up-coredns-provider-federation/" target="_blank">Set up CoreDNS as DNS provider for Cluster Federation</a></li>
</ul>

<style>
#h2 {
    margin-bottom:2em; 
    margin-right: 5px; 
    padding: 8px 15px; 
    letter-spacing: 2px; 
    background-image: linear-gradient(to right bottom, rgb(0, 188, 212), rgb(63, 81, 181)); 
    background-color: rgb(63, 81, 181); 
    color: rgb(255, 255, 255); 
    border-left: 10px solid rgb(51, 51, 51); 
    border-radius:5px; 
    text-shadow: rgb(102, 102, 102) 1px 1px 1px; 
    box-shadow: rgb(102, 102, 102) 1px 1px 2px;
}
#inline-yellow {
display:inline;
padding:.2em .6em .3em;
font-size:80%;
font-weight:bold;
line-height:1;
color:#fff;
text-align:center;
white-space:nowrap;
vertical-align:baseline;
border-radius:0;
background-color: #f0ad4e;
}
#inline-green {
display:inline;
padding:.2em .6em .3em;
font-size:80%;
font-weight:bold;
line-height:1;
color:#fff;
text-align:center;
white-space:nowrap;
vertical-align:baseline;
border-radius:0;
background-color: #5cb85c;
}
#inline-blue {
display:inline;
padding:.2em .6em .3em;
font-size:80%;
font-weight:bold;
line-height:1;
color:#fff;
text-align:center;
white-space:nowrap;
vertical-align:baseline;
border-radius:0;
background-color: #2780e3;
}
#inline-purple {
display:inline;
padding:.2em .6em .3em;
font-size:80%;
font-weight:bold;
line-height:1;
color:#fff;
text-align:center;
white-space:nowrap;
vertical-align:baseline;
border-radius:0;
background-color: #9954bb;
}
#div-border-left-red {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-left-width: 5px;
border-radius: 3px;
border-left-color: #df3e3e;
}
#div-border-left-yellow {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-left-width: 5px;
border-radius: 3px;
border-left-color: #f0ad4e;
}
#div-border-left-green {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-left-width: 5px;
border-radius: 3px;
border-left-color: #5cb85c;
}
#div-border-left-blue {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-left-width: 5px;
border-radius: 3px;
border-left-color: #2780e3;
}
#div-border-left-purple {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-left-width: 5px;
border-radius: 3px;
border-left-color: #9954bb;
}
#div-border-right-red {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-right-width: 5px;
border-radius: 3px;
border-right-color: #df3e3e;
}
#div-border-right-yellow {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-right-width: 5px;
border-radius: 3px;
border-right-color: #f0ad4e;
}
#div-border-right-green {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-right-width: 5px;
border-radius: 3px;
border-right-color: #5cb85c;
}
#div-border-right-blue {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-right-width: 5px;
border-radius: 3px;
border-right-color: #2780e3;
}
#div-border-right-purple {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-right-width: 5px;
border-radius: 3px;
border-right-color: #9954bb;
}
#div-border-top-red {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-top-width: 5px;
border-radius: 3px;
border-top-color: #df3e3e;
}
#div-border-top-yellow {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-top-width: 5px;
border-radius: 3px;
border-top-color: #f0ad4e;
}
#div-border-top-green {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-top-width: 5px;
border-radius: 3px;
border-top-color: #5cb85c;
}
#div-border-top-blue {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-top-width: 5px;
border-radius: 3px;
border-top-color: #2780e3;
}
#div-border-top-purple {
display: block;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-top-width: 5px;
border-radius: 3px;
border-top-color: #9954bb;
}
</style>
            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://www.yangcs.net/posts/k8s-network-expand/" data-toggle="tooltip" data-placement="top" title="Kubernetes 网络扩展">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://www.yangcs.net/posts/linux-circumvent/" data-toggle="tooltip" data-placement="top" title="Linux全局智能分流方案">Next Post &rarr;</a>
                </li>
                
            </ul>
            
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/k8s-network-expand/">Kubernetes 网络扩展</a></li>
                    
                    <li><a href="/posts/calico-rr/">calico Router reflection(RR) 模式介绍及部署</a></li>
                    
                </ul>
                
            </div>
            
            
            
            
<div>
    <section id="datecount">
        <h4 id="date"> Thu Mar 22, 2018</h4>
    </section>
    <h5 id="wc">4400 Words|Read in about 9 Min</h5>
    <h5 id="tags">Tags: 
        
        <a href="https://www.yangcs.nettags/kubernetes/">kubernetes</a> &nbsp;
    </h5>
</div>

            
            </div>
            
            
                
                 <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<aside id=comments>
    <div>
        <h2> Comments </h2>
    </div>
    <div id="container"></div>
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    
    <script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'yangchuansheng', 
            repo: 'hugo-gitment', 
            oauth: {
                client_id: '6eb551e8b04b1f8ff095',
                client_secret: '27c15dcbb6fcb6ef33d4dfaef7302e2eb59529b8',
            },
        })
        gitment.render('container')
    </script>
</aside>
</div>

                
            
        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://www.facebook.com/ryanyangio" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://plus.google.com/111949124259063786697" title="Google&#43;">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/yangchuansheng" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/Paranoid_yang" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://drive.google.com/drive/folders/0By_W-zIhlMXqSGJyU3pHaVVpV2M" title="小视频共享">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-youtube-play fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://www.yangcs.net/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017-2018
          
            
              Ryan Yang
                      
          
          
          
            &nbsp;&bull;&nbsp;
            <a href="https://www.yangcs.net">Ryan Yang</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.37</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>


<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/bootstrap.min.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/photoswipe-ui-default.min.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/photoswipe.min.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/auto-render.min.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/main.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/prism.js"></script>
<script src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/katex.min.js"></script>
<script> renderMathInElement(document.body); </script>



  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a66dcf22e59dc17"></script>





  </body>
</html>

